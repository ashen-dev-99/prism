<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sidebar Toggle Fix Test</title>
    <link rel="stylesheet" href="dist/prism-theme.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        .test-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #000;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <div class="test-info">
        <div>Sidebar State: <span id="sidebar-state">expanded</span></div>
        <div>Button Position: <span id="button-position">normal</span></div>
        <div>Icon Rotation: <span id="icon-rotation">0deg</span></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-brand">
            <div class="header-brand-logo">
                <i class="fas fa-cube"></i>
            </div>
            <span class="header-brand-text">Prism Admin</span>
        </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar" data-component="sidebar">
        <nav class="sidebar-nav">
            <div class="sidebar-nav-section">
                <h6 class="sidebar-nav-section-title">Main</h6>
                <ul class="sidebar-nav-list">
                    <li class="sidebar-nav-item">
                        <a href="#" class="sidebar-nav-link active">
                            <i class="fas fa-home nav-icon"></i>
                            <span class="nav-text">Dashboard</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="#" class="sidebar-nav-link">
                            <i class="fas fa-users nav-icon"></i>
                            <span class="nav-text">Users</span>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
    </aside>

    <!-- Sidebar Toggle -->
    <button class="sidebar-toggle" data-sidebar-toggle>
        <i class="fas fa-chevron-left sidebar-toggle-icon"></i>
    </button>

    <!-- Main Content -->
    <main class="main-content">
        <div class="main-content-wrapper">
            <h1>Sidebar Toggle Test</h1>
            <p>Click the toggle button to test the fix:</p>
            <ul>
                <li>Button should move smoothly with the sidebar</li>
                <li>Icon should rotate 180 degrees when collapsed</li>
                <li>No floating button in wrong position</li>
            </ul>
            <button onclick="localStorage.clear(); location.reload();" style="margin-top: 20px; padding: 10px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;">
                Clear localStorage & Reload
            </button>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-wrapper">
            <div class="footer-bottom">
                <p class="footer-bottom-text">&copy; 2024 Prism Theme. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script type="module" src="src/index.js"></script>
    <script>
        // Test script to monitor state changes
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.querySelector('.sidebar');
            const button = document.querySelector('.sidebar-toggle');
            const icon = document.querySelector('.sidebar-toggle-icon');
            const stateSpan = document.getElementById('sidebar-state');
            const positionSpan = document.getElementById('button-position');
            const rotationSpan = document.getElementById('icon-rotation');

            function updateDisplay() {
                const isCollapsed = sidebar.classList.contains('sidebar--collapsed');
                const bodyCollapsed = document.body.classList.contains('sidebar-collapsed');
                const computedStyle = window.getComputedStyle(icon);
                const transform = computedStyle.transform;
                const buttonStyle = window.getComputedStyle(button);
                const buttonLeft = parseFloat(buttonStyle.left);
                
                stateSpan.textContent = isCollapsed ? 'collapsed' : 'expanded';
                
                // Check actual button position vs expected position
                const expectedLeftExpanded = 256; // $sidebar-width (16rem = 256px)
                const expectedLeftCollapsed = 64; // $sidebar-width-collapsed (4rem = 64px)
                const tolerance = 10;
                
                if (Math.abs(buttonLeft - expectedLeftExpanded) < tolerance) {
                    positionSpan.textContent = 'normal (expanded)';
                } else if (Math.abs(buttonLeft - expectedLeftCollapsed) < tolerance) {
                    positionSpan.textContent = 'collapsed';
                } else {
                    positionSpan.textContent = `actual: ${Math.round(buttonLeft)}px`;
                }
                
                // Extract rotation from transform matrix
                if (transform && transform !== 'none') {
                    const matrix = transform.match(/matrix\(([^)]+)\)/);
                    if (matrix) {
                        const values = matrix[1].split(',');
                        const a = parseFloat(values[0]);
                        const b = parseFloat(values[1]);
                        const angle = Math.round(Math.atan2(b, a) * 180 / Math.PI);
                        rotationSpan.textContent = angle + 'deg';
                    }
                } else {
                    rotationSpan.textContent = '0deg';
                }
            }

            // Monitor changes
            const observer = new MutationObserver(updateDisplay);
            observer.observe(sidebar, { attributes: true, attributeFilter: ['class'] });
            observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
            observer.observe(icon, { attributes: true, attributeFilter: ['style'] });

            // Initial display
            updateDisplay();
            
            // Debug initial state
            console.log('Initial state:');
            console.log('Sidebar collapsed:', sidebar.classList.contains('sidebar--collapsed'));
            console.log('Body collapsed:', document.body.classList.contains('sidebar-collapsed'));
            console.log('localStorage:', localStorage.getItem('sidebar-collapsed'));
            console.log('Button left position:', window.getComputedStyle(button).left);
        });
    </script>
</body>
</html>
