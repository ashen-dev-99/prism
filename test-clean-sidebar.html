<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean Sidebar Test</title>
    <link rel="stylesheet" href="dist/prism-theme.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .test-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #000;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            z-index: 9999;
            font-size: 12px;
        }
        .test-controls {
            margin: 20px 0;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        .test-controls button {
            margin: 5px;
            padding: 8px 16px;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-controls button:hover {
            background: #4f46e5;
        }
    </style>
</head>
<body>
    <div class="test-info">
        <div>Sidebar State: <span id="sidebar-state">loading...</span></div>
        <div>Button Position: <span id="button-position">loading...</span></div>
        <div>Icon Rotation: <span id="icon-rotation">loading...</span></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-brand">
            <div class="header-brand-logo">
                <i class="fas fa-cube"></i>
            </div>
            <span class="header-brand-text">Prism Admin</span>
        </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar" data-component="sidebar">
        <nav class="sidebar-nav">
            <div class="sidebar-nav-section">
                <h6 class="sidebar-nav-section-title">Main</h6>
                <ul class="sidebar-nav-list">
                    <li class="sidebar-nav-item">
                        <a href="#" class="sidebar-nav-link active">
                            <i class="fas fa-home nav-icon"></i>
                            <span class="nav-text">Dashboard</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="#" class="sidebar-nav-link">
                            <i class="fas fa-users nav-icon"></i>
                            <span class="nav-text">Users</span>
                            <span class="nav-badge">12</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="#" class="sidebar-nav-link">
                            <i class="fas fa-shopping-cart nav-icon"></i>
                            <span class="nav-text">Orders</span>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
    </aside>

    <!-- Sidebar Toggle -->
    <button class="sidebar-toggle" data-sidebar-toggle>
        <i class="fas fa-chevron-left sidebar-toggle-icon"></i>
    </button>

    <!-- Main Content -->
    <main class="main-content">
        <div class="main-content-wrapper">
            <h1>Clean Sidebar Test</h1>
            
            <div class="test-controls">
                <h3>Test Controls</h3>
                <button onclick="window.sidebar.toggle()">Toggle Sidebar</button>
                <button onclick="window.sidebar.collapse()">Collapse</button>
                <button onclick="window.sidebar.expand()">Expand</button>
                <button onclick="localStorage.clear(); location.reload();">Reset & Reload</button>
            </div>
            
            <h3>Expected Behavior:</h3>
            <ul>
                <li>Button should move smoothly with sidebar</li>
                <li>Icon should rotate 180Â° when collapsed</li>
                <li>No floating button issues</li>
                <li>State should persist on reload</li>
            </ul>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-wrapper">
            <div class="footer-bottom">
                <p class="footer-bottom-text">&copy; 2024 Prism Theme. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script type="module" src="src/index.js"></script>
    <script>
        // Test script to monitor state changes
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.querySelector('.sidebar');
            const button = document.querySelector('.sidebar-toggle');
            const icon = document.querySelector('.sidebar-toggle-icon');
            const stateSpan = document.getElementById('sidebar-state');
            const positionSpan = document.getElementById('button-position');
            const rotationSpan = document.getElementById('icon-rotation');

            function updateDisplay() {
                const isCollapsed = sidebar.classList.contains('sidebar--collapsed');
                const buttonStyle = window.getComputedStyle(button);
                const iconStyle = window.getComputedStyle(icon);
                const buttonLeft = parseFloat(buttonStyle.left);
                const transform = iconStyle.transform;
                
                stateSpan.textContent = isCollapsed ? 'collapsed' : 'expanded';
                
                // Check actual button position
                const expectedLeftExpanded = 256; // $sidebar-width
                const expectedLeftCollapsed = 64; // $sidebar-width-collapsed
                const tolerance = 10;
                
                if (Math.abs(buttonLeft - expectedLeftExpanded) < tolerance) {
                    positionSpan.textContent = 'normal (expanded)';
                } else if (Math.abs(buttonLeft - expectedLeftCollapsed) < tolerance) {
                    positionSpan.textContent = 'collapsed';
                } else {
                    positionSpan.textContent = `actual: ${Math.round(buttonLeft)}px`;
                }
                
                // Extract rotation from transform matrix
                if (transform && transform !== 'none') {
                    const matrix = transform.match(/matrix\(([^)]+)\)/);
                    if (matrix) {
                        const values = matrix[1].split(',');
                        const a = parseFloat(values[0]);
                        const b = parseFloat(values[1]);
                        const angle = Math.round(Math.atan2(b, a) * 180 / Math.PI);
                        rotationSpan.textContent = angle + 'deg';
                    }
                } else {
                    rotationSpan.textContent = '0deg';
                }
            }

            // Monitor changes
            const observer = new MutationObserver(updateDisplay);
            observer.observe(sidebar, { attributes: true, attributeFilter: ['class'] });
            observer.observe(icon, { attributes: true, attributeFilter: ['style'] });

            // Initial display
            updateDisplay();
            
            // Debug info
            console.log('Clean sidebar test loaded');
            console.log('Sidebar instance:', window.sidebar);
        });
    </script>
</body>
</html>
